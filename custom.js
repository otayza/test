(window.webpackJsonp = window.webpackJsonp || []).push([["chunk-5d798dff"], { "18df": function (t, e, n) { }, 1972: function (t, e, n) { }, "5c72": function (t, e, n) { "use strict"; n("e5c8") }, "78a0": function (t, e, n) { }, "7ec06": function (t, e, n) { "use strict"; n("18df") }, "963b": function (t, e, n) { "use strict"; n("1972") }, c735: function (t, e, n) { "use strict"; n("78a0") }, d6ae: function (t, e, n) { "use strict"; n.r(e); var a = n("3835"), r = n("1da1"), i = n("5530"), o = (n("96cf"), n("a9e3"), n("ac1f"), n("5319"), n("d3b7"), n("3ca3"), n("ddb0"), n("99af"), n("caad"), n("7db0"), n("d81d"), n("1276"), n("2f62")), s = { props: { run: Boolean, imgUrl: String, delay: Number }, data: function () { return { st: null, ref: "ref_".concat(Math.random()), wrapDom: null, top: 0, height: 0, animationId: null, speed: 1, maxSpeed: 8, speedSt: null, runAnimation: !1 } }, mounted: function () { this.init() }, beforeDestroy: function () { clearTimeout(this.speedSt) }, methods: { stopHandler: function () { var t = this; clearTimeout(this.speedSt), this.speed <= 1 ? this.runAnimation = !1 : this.speedSt = setTimeout((function () { t.speed -= 1, t.stopHandler() }), 200) }, init: function () { var t = this; this.getWrapDom().then((function (e) { var n = e.getBoundingClientRect().height; t.height = n - 40 })) }, ranHandler: function () { this.runAnimation = !0, this.top = 0, this.speed = 1, clearTimeout(this.speedSt), this.setSpeed(), window.requestAnimationFrame(this.animationHandler) }, setSpeed: function () { var t = this; clearTimeout(this.speedSt), this.speed >= this.maxSpeed || (this.speedSt = setTimeout((function () { t.speed += 1, t.setSpeed() }), 200)) }, animationHandler: function () { this.runAnimation && (this.top -= this.speed, Math.abs(this.top) >= this.height && (this.top = 0), this.wrapDom.style.top = this.top + "px", window.requestAnimationFrame(this.animationHandler)) }, getWrapDom: function () { var t = this; return Object(r.a)(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (!t.wrapDom) { e.next = 2; break } return e.abrupt("return", t.wrapDom); case 2: return e.abrupt("return", new Promise((function (e) { t.$nextTick((function () { t.wrapDom = t.$refs[t.ref], e(t.wrapDom) })) }))); case 3: case "end": return e.stop() } }), e) })))() } }, watch: { run: { handler: function (t, e) { var n = this; t ? (clearTimeout(this.speedSt), this.speedSt = setTimeout((function () { n.ranHandler() }), 2e3 * this.delay)) : e && !t && (clearTimeout(this.speedSt), this.speedSt = setTimeout((function () { n.stopHandler() }), 1e3 * this.delay)) } } } }, c = s, u = (n("963b"), n("2877")), m = Object(u.a)(c, (function () { var t = this, e = t.$createElement, n = t._self._c || e; return n("transition", { attrs: { name: "fade" } }, [n("div", { ref: t.ref, staticClass: "animation_item" }, t._l(22, (function (e) { return n("div", { key: e, staticClass: "img_box" }, [n("img", { attrs: { src: t.imgUrl, alt: "" } })]) })), 0)]) }), [], !1, null, null, null), l = { components: { animationItem: m.exports }, mounted: function () { } }, d = (n("5c72"), Object(u.a)(l, (function () { var t = this, e = t.$createElement, n = t._self._c || e; return n("div", { staticClass: "animation_layout" }, [n("div", { staticClass: "contain df" }, t._l(3, (function (e) { return n("animationItem", t._b({ key: e, attrs: { delay: .2 * e } }, "animationItem", t.$attrs, !1)) })), 1)]) }), [], !1, null, null, null)), f = d.exports, h = n("f499"), p = n("d053"), g = { props: { run: Boolean }, data: function () { return { isShow: !1, count: 5 } }, methods: { runCount: function () { var t = this; if (clearTimeout(this.countSt), this.count <= 0) return this.isShow = !1, void this.$emit("countDone"); this.countSt = setTimeout((function () { t.count--, t.runCount() }), 1e3) } }, computed: { showObj: { get: function () { return this.isShow && this.count > 0 }, set: function (t) { this.isShow = t } } }, beforeDestroy: function () { clearTimeout(this.countSt) }, watch: { run: { handler: function (t) { t && (this.count = 5, this.isShow = !0, this.runCount()) }, immediate: !0 } } }, b = g, v = (n("7ec06"), Object(u.a)(b, (function () { var t = this, e = t.$createElement, n = t._self._c || e; return n("van-popup", { staticStyle: { background: "transparent" }, attrs: { "close-on-click-overlay": !1 }, model: { value: t.showObj, callback: function (e) { t.showObj = e }, expression: "showObj" } }, [n("div", { staticClass: "count_wrap df df_jc df_ac" }, [n("transition", { attrs: { name: "fade" } }, [n("div", { key: t.count, staticClass: "count", class: "bg_" + t.count })])], 1)]) }), [], !1, null, "500b6364", null)), _ = v.exports, w = n("8f7f"), C = { name: "grab", data: function () { return { roomInfo: {}, loading: !1, grabOrderData: {}, showGrabDetail: !1, imageUrl: "", accountDetail: {}, runAnimation: !1, runCount: !1, countDone: !1, animationKey: Math.random(), timeSt: null, refreshFundLoading: !1, refreshKey: Math.random(), comGrabSuccessSt: null, bstop: !1 } }, components: { animation: f, orderItem: p.a, count: _ }, computed: Object(i.a)(Object(i.a)(Object(i.a)({}, Object(o.c)("user", ["userInfo", "userFund"])), Object(o.c)("site", ["rooms", "grabConfig"])), {}, { comImageUrl: function () { return this.imageUrl ? this.imageUrl : n("015a") }, roomId: function () { return this.$route.query.id }, todayOverview: function () { var t = [], e = this.accountDetail, n = Number(this.userFund.canAmount) || 0; return t.push({ text: this.$t("grab.commission"), code: "commission", value: Object(h.j)(e.commission) }), t.push({ text: this.$t("home.availableBalance"), code: "availableBalance", value: Object(h.j)(n + Number(e.canAmount)) }), t.push({ text: this.$t("home.completedOrders"), code: "completedOrders", value: Number(e.completedOrderCount) }), t.push({ text: this.$t("home.cancelled"), code: "cancelled", value: Object(h.j)(e.canceledOrderAmount) }), t.push({ text: this.$t("home.yesterdayCommission"), code: "yesterdayCommission", value: Object(h.j)(e.yesterdayCommission) }), t.push({ text: this.$t("home.yesterdayTeamCommission"), code: "yesterdayTeamCommission", value: Object(h.j)(e.yesterdayTeamCommission) }), t }, currentBalance: function () { return (Number(this.userFund.canAmount) || 0) + Number(this.accountDetail.canAmount) } }), mounted: function () { var t = this; return Object(r.a)(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (t.roomId) { e.next = 2; break } return e.abrupt("return", t.$router.replace("/home")); case 2: if (e.prev = 2, t.userInfo && void 0 !== t.userInfo.rankLevel) { e.next = 6; break } return e.next = 6, t.getUserInfo(); case 6: if (t.userFund && void 0 !== t.userFund.canAmount) { e.next = 9; break } return e.next = 9, t.getUserFund(); case 9: e.next = 14; break; case 11: e.prev = 11, e.t0 = e.catch(2); case 14: t.getRoomInfoByList(t.roomId), t.refreshFundLoading = !0, t.getAccountDetail().finally((function () { t.refreshFundLoading = !1 })); case 17: case "end": return e.stop() } }), e, null, [[2, 11]]) })))() }, beforeDestroy: function () { clearTimeout(this.timeSt), clearTimeout(this.comGrabSuccessSt) }, methods: Object(i.a)(Object(i.a)({}, Object(o.b)("user", ["getUserFund", "chechUserBanGrab", "getUserInfo"])), {}, { runAnimationHandler: function () { var t = this; return new Promise((function (e) { t.runAnimation = !0, clearTimeout(t.timeSt), t.timeSt = setTimeout((function () { e() }), 3e3) })) }, countDoneHandler: function () { this.grabOrder() }, refreshHandler: function () { var t = this; this.bstop || (this.bstop = !0, this.refreshFundLoading = !0, Promise.all([this.getAccountDetail(), this.getUserFund()]).finally((function () { t.refreshFundLoading = !1, setTimeout((function () { t.bstop = !1 }), 5e3) }))) }, getAccountDetail: function () { var t = this, e = Object(w.b)(), n = Object(a.a)(e, 2), r = n[0], i = n[1]; return this.$get("/trade/order/toc/todayOverview", { beginTime: r, endTime: i, userId: this.userInfo.id }).then((function (e) { t.accountDetail = Object.assign({ canAmount: 0 }, e), t.refreshKey = Math.random() })) }, successHandler: function () { if (this.grabOrderData) { this.grabOrderData.status = 2, this.countTodayOverview() } this.showGrabDetail = !1 }, countTodayOverview: function () { var t = this.accountDetail, e = this.grabOrderData || {}, n = e.commission, a = e.totalOrderAmount; t.commission = Number(t.commission) + Number(n), t.canAmount = Number(t.canAmount) + Number(a), t.completedOrderCount++ }, formatCommissionRate: function (t) { return Object(h.c)(t) }, grabOrder: function () { var t = this; return Object(r.a)(regeneratorRuntime.mark((function e() { var n, a; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.prev = 0, e.next = 3, t.chechUserBanGrab(); case 3: e.next = 8; break; case 5: return e.prev = 5, e.t0 = e.catch(0), e.abrupt("return", t.$toast(e.t0.message)); case 8: if (!t.loading) { e.next = 10; break } return e.abrupt("return"); case 10: return t.imageUrl = "", t.loading = !0, n = !1, a = function () { t.runAnimation = !1, t.loading = !1, t.runCount = !1, clearTimeout(t.timeSt), t.timeSt = setTimeout((function () { n && (t.showGrabDetail = !0), t.animationKey = Math.random() }), 1500) }, e.next = 16, t.runAnimationHandler(); case 16: return e.prev = 16, e.next = 19, t.checkGrabSuccess(); case 19: e.next = 25; break; case 21: return e.prev = 21, e.t1 = e.catch(16), t.$alert({ message: e.t1.message }), e.abrupt("return", a()); case 25: t.$post("/trade/order/toc/grabOrder", { roomId: t.roomInfo.id, userId: t.userInfo.id }).then((function (e) { var a = e || {}, r = a.totalGoodsAmount, i = a.goodsImage; i && (i = t.formatImage(i), e.goodsImage = i), t.grabOrderData = e, t.imageUrl = i, t.accountDetail.canAmount -= Number(r), n = !0 })).catch((function (e) { var a = e.code, r = e.originalMessage, i = r ? "".concat(r, " (Code: ").concat(a, ")") : e.message; if (23002 === Number(a)) return t.showAlreadyOrderTip(i); t.$toast(i); if (e.data && [23004].includes(a)) { var o = e.data, s = o.image, c = o.title, u = o.price, m = o.totalPrice, l = o.number; Object.assign(o, { goodsImage: t.formatImage(s), goodsTitle: c, goodsPrice: u, totalGoodsAmount: m, goodsNumber: l, showRecharge: !0, messageStr: t.$t("grab.balanceInsufficient") }), t.grabOrderData = o, t.imageUrl = t.formatImage(o.goodsImage), n = !0 } })).finally((function () { a() })); case 26: case "end": return e.stop() } }), e, null, [[0, 5], [16, 21]]) })))() }, automaticGrabHandler: function () { var t = this; if (this.currentBalance < 50000000) return this.$confirm({ message: this.$t("grab.insufficientBalance"), confirmButtonText: this.$t("grab.goDeposit") }).then((function () { t.$router.push("/deposit") })).catch((function () { })); this.roomInfo.id || this.$alert({ message: this.$t("home.rooidIsFail") }).then((function () { t.$router.push("/home") })), this.runCount = !0, this.imageUrl = null }, checkLock: function () { var t = this.roomInfo || {}, e = t.minLevelLimit, n = t.maxLevelLimit, a = t.minBalanceLimit, r = t.maxBalanceLimit, i = +this.userInfo.rankLevel || 0, o = +this.userFund.canAmount || 0; return !(i >= +e && i <= +n && o >= +a && o <= +r) }, getRoomInfoByList: function (t) { var e = this.rooms.find((function (e) { return e.id === t })), n = !0; e && (this.roomInfo = e, n = this.checkLock()), n && this.genNotMatchTip() }, getOrderInfo: function (t) { var e = this; this.loading || (this.loading = !0, this.$loading(), this.$get("/trade/room/toc/get", { id: t }).then((function (t) { e.roomInfo = t, e.checkLock() && e.genNotMatchTip() })).catch((function (t) { e.$toast(t.message) })).finally((function () { e.loading = !1, e.$closeLoading() }))) }, checkGrabSuccess: function () { var t = this; return clearTimeout(this.comGrabSuccessSt), new Promise((function (e, n) { if (t.grabConfig) { var r = t.grabConfig, i = r.controlTimeRange, o = r.grabSuccessRate, s = (new Date).getTime(), c = t.$tz(new Date, "%c", "en_US", "America/New_York"), u = i.map((function (t) { var e = t.split(":"), n = Object(a.a)(e, 2), r = n[0], i = n[1]; return new Date(c.replace(/\d{2}:\d{2}:\d{2} \s?[AM|am|PM|pm]{2}/, "".concat(r % 12, ":").concat(i, ":00 ").concat(["AM", "PM"][Math.floor(r / 12)]))).getTime() })), m = Object(a.a)(u, 2), l = m[0], d = m[1]; if (l > d && (l -= 864e5), s >= l && s <= d) if (!(o > Object(h.g)(0, 1e4))) return t.comGrabSuccessSt = setTimeout((function () { n(new Error(t.$t("grab.grabFailTip"))) }), 3e3); return e(!0) } e(!0) })) }, genNotMatchTip: function () { var t = this; this.$alert({ message: this.$t("home.entryConditionsAreNotMet") }).then((function () { t.$router.replace("/home") })) }, showAlreadyOrderTip: function (t) { var e = this; this.$confirm({ message: t, confirmButtonText: this.$t("grab.goComplete") }).then((function () { e.$router.push({ name: "Order", params: { code: "pending" } }) })) } }) }, O = C, y = (n("c735"), Object(u.a)(O, (function () { var t = this, e = t.$createElement, n = t._self._c || e; return n("wa-page", [n("wa-header", { attrs: { slot: "header", showLeft: !1, title: t.$t("grab.grab") }, slot: "header" }), n("section", { staticClass: "grab_content" }, [n("div", { staticClass: "grab_info item_wrap fz14" }, [n("p", { staticClass: "title df df_ac" }, [n("span", { staticClass: "fz16 fw600 room_name" }, [t._v(t._s(t.roomInfo.name))]), n("span", { directives: [{ name: "show", rawName: "v-show", value: t.roomInfo.commissionRate, expression: "roomInfo.commissionRate" }] }, [t._v(" " + t._s(t._f("lang")("commissionRate")) + ": "), n("span", { staticClass: "text-active fw600 ly_dib" }, [t._v(t._s(t._f("formatCommissionRate")(t.roomInfo.commissionRate)) + "%")])])]), n("p", [t._v(t._s(t._f("lang")("grab.exclusiveChannelForExclusiveMembers")))]), n("div", { staticClass: "grab_animation" }, [n("animation", { key: t.animationKey, attrs: { run: t.runAnimation, imgUrl: t.comImageUrl } }), n("count", { attrs: { run: t.runCount }, on: { countDone: t.countDoneHandler } })], 1), n("p", { staticClass: "tip" }, [t._v(t._s(t._f("lang")("grab.exclusiveChannelForExclusiveMembers")))])]), n("div", { staticClass: "btns df fz16 fw600" }, [n("span", { staticClass: "bg-yellow", on: { click: function (e) { return t.$router.push("/deposit") } } }, [t._v(" " + t._s(t._f("lang")("grab.depositUpgrade")) + " ")]), n("span", { staticClass: "bg-blue", on: { click: t.automaticGrabHandler } }, [t._v(" " + t._s(t._f("lang")("grab.automaticGrab")) + " ")])]), n("div", { directives: [{ name: "loading", rawName: "v-loading", value: t.refreshFundLoading, expression: "refreshFundLoading" }], staticClass: "item_wrap achievements" }, [n("p", { staticClass: "title" }, [n("span", { staticClass: "fz16 fw600" }, [t._v(t._s(t._f("lang")("grab.todayAchievements")))]), n("span", { class: t.bstop ? "fz20 refresh fontColor" : "fz20 refresh", on: { click: t.refreshHandler } }, [n("van-icon", { attrs: { name: "replay" } })], 1)]), n("div", { key: t.refreshKey, staticClass: "count" }, t._l(t.todayOverview, (function (e, a) { return n("div", { key: a, staticClass: "count_item" }, [n("div", { staticClass: "count_content" }, [n("p", { staticClass: "fz12" }, [t._v(t._s(e.text))]), n("h1", { staticClass: "fz18 fw600" }, [t._v(t._s(e.value || 0))])])]) })), 0), n("p", { staticClass: "tip" }, [t._v(t._s(t._f("lang")("grab.higherLevelsTip")))])]), n("div", { staticClass: "item_wrap rule_wrap fz14" }, [n("p", { staticClass: "title" }, [n("span", { staticClass: "rule_title" }, [t._v(t._s(t._f("lang")("grab.ruleDescription")))])]), n("p", { staticClass: "rule_line" }, [t._v(" (1) "), n("span", { domProps: { innerHTML: t._s(t.$t("grab.rule1", { n: t.roomInfo.dailyOrders || 0 })) } })]), n("p", { staticClass: "rule_line" }, [t._v(" (2) "), n("span", { domProps: { innerHTML: t._s(t.$t("grab.rule2", { rate: t.formatCommissionRate(t.roomInfo.commissionRate) + "%" })) } })]), n("p", { staticClass: "rule_line" }, [t._v("(3) " + t._s(t._f("lang")("grab.rule3")))]), n("p", { staticClass: "rule_line" }, [t._v("(4) " + t._s(t._f("lang")("grab.rule4")))])]), n("orderItem", { attrs: { item: t.grabOrderData }, on: { onSuccess: t.successHandler }, model: { value: t.showGrabDetail, callback: function (e) { t.showGrabDetail = e }, expression: "showGrabDetail" } })], 1), n("wa-footer", { attrs: { slot: "footer" }, slot: "footer" })], 1) }), [], !1, null, "2e68f181", null)); e.default = y.exports }, e5c8: function (t, e, n) { } }]);